<ons-page id="itemRegist">
  <ons-toolbar>
    <div class="left"><ons-back-button>Back</ons-back-button></div>
    <div class="center">アイテム登録</div>    
  </ons-toolbar>

    <h4>カテゴリー：</h4>
    <div style="text-align: center">
      <ons-select id="category" modifier="underbar" onchange="changeCategory()">
        <option value = 1>トップス</option>
        <option value = 2>ボトムス</option>
        <option value = 3>アウター</option>
        <option value = 4>ワンピース</option>
        <option value = 5>シューズ</option>
      </ons-select>
    </div>
    
    <h4>サブカテゴリー：</h4>
    <div style="text-align: center">
      <ons-select id="sub_category" modifier="underbar">
        <option value = 1>Tシャツ</option>
        <option value = 2>ポロシャツ</option>
        <option value = 3>パーカー</option>
        <option value = 4>ニット</option>
        <option value = 5>インナー</option>      
      </ons-select>
    </div>
    
    <h4>カラー：</h4>
    <div style="text-align: center">
      <ons-select id="color" modifier="underbar">
        <option value = 1>赤</option>
        <option value = 2>茶</option>
        <option value = 3>橙</option>
        <option value = 4>黄</option>
        <option value = 5>緑</option>
        <option value = 6>青</option>
        <option value = 7>紫</option>
        <option value = 8>黒</option>
        <option value = 9>白</option>
        <option value = 10>桃</option>
        <option value = 11>グレー</option>
        <option value = 12>ベージュ</option>
      </ons-select>
    </div>

    <h4>柄：</h4>
    <div style="text-align: center">
      <ons-select id="design" modifier="underbar">
        <option value = 1>無地</option>
        <option value = 2>水玉（ドット）</option>
        <option value = 3>ストライプ</option>
        <option value = 4>ボーダー</option>
        <option value = 5>チェック</option>
        <option value = 6>ペイズリー</option>
        <option value = 7>迷彩</option>
        <option value = 8>アニマル</option>
      </ons-select>
    </div>

    <h4>素材：</h4>
    <div style="text-align: center">
      <ons-select id="material" modifier="underbar">
        <option value = 1>ナイロン</option>
        <option value = 2>ポリエステル</option>
        <option value = 3>ポリウレタン</option>
        <option value = 4>レーヨン</option>
        <option value = 5>アクリル</option>
        <option value = 6>綿（コットン）</option>
        <option value = 7>毛（ウール）</option>
        <option value = 8>麻（リネン）</option>
        <option value = 9>絹（シルク）</option>
        <option value = 10>ポリノジック</option>
        <option value = 11>キュプラ</option>
        <option value = 12>リヨセル</option>
      </ons-select>
    </div>
    
    <h4>季節：</h4>
    <div style="text-align: center">
      <ons-row>
        <ons-col><ons-radio name="season" input-id="radio-1" value = 1 checked>春</ons-radio></ons-col>
        <ons-col><ons-radio name="season" input-id="radio-2" value = 2>夏</ons-radio></ons-col>
        <ons-col><ons-radio name="season" input-id="radio-3" value = 3>秋</ons-radio></ons-col>
        <ons-col><ons-radio name="season" input-id="radio-4" value = 4>冬</ons-radio></ons-col>
      </ons-row>
    </div>
    
    <h4>サイズ：</h4>
    <div style="text-align: center">
      <ons-select id="size" modifier="underbar">
        <option value="1">XS</option>
        <option value="2">S</option>
        <option value="3">M</option>
        <option value="4">L</option>
        <option value="5">XL</option>
        <option value="6">XXL</option>
        <option value="7">3XL</option>
      </ons-select>
    </div>

    <h4>ブランド：</h4>
    <div style="text-align: center">
      <ons-input id="brand" modifier="material" placeholder="ブランド" float></ons-input>
    </div>

    <h4>備考：</h4>
    <div style="text-align: center">
      <textarea  id="remarks" class="textarea" rows="5" cols="25" placeholder="備考"></textarea>
    </div>

    <h4>画像：</h4>
    <div style="text-align: center">
      <img id="regist-image" src="image/1_4_black.png">
    </div>  

    <br>
    <div style="text-align: center">
        <ons-button onclick="itemRegist_mobileBackend()">登録</ons-button>
    </div>
    
  <script>
    // 画面表示時に起動
     ons.getScriptPage().onShow = function() {
      var image = document.getElementById("regist-image");
      var screenWidth = screen.width;
      var screenHeight = screen.height;
      
      image.height = screenHeight / 3;
      image.width = screenWidth / 4 * 3;
    };

    document.getElementById("regist-image").addEventListener('click', function(event){
      boot_camera();
    }, false);

    //カテゴリーが変更された場合、以下を変更する
    //  １：サブカテゴリーのドロップダウンのメニュー項目
    //  ２：イメージ画像
    function changeCategory(){
      // カテゴリーのプルダウン
      var category_select = document.getElementById("category");
      // サブカテゴリーのプルダウン
      var subCategory_select = document.getElementById("sub_category");

      // サブカテゴリーの項目
      const sub_categories = [
        ["Tシャツ","ポロシャツ","パーカー","ニット","インナー"],
        ["ワイドパンツ","スキニー","ミニスカート","ロングスカート","ショートパンツ"],
        ["ジャケット","ダウンコード","カーディガン","ブルゾン","ライダース"],
        ["ニットワンピース（ミニ）","ニットワンピース（ロング）","シャツワンピース（ミニ）","シャツワンピース（ロング）"],
        ["スニーカー","サンダル","ロングブーツ","ショートブーツ","ヒールパンプス","フラットパンプス","ローファー"]
      ];
      // 選択された項目番号
      const index = category_select.selectedIndex;

      // サブカテゴリーのプルダウンを初期化
      subCategory_select.length = 0;

      // サブカテゴリーのリストを作成し設定
      for (let i = 0 ; i < sub_categories[index].length ; i++) {
        subCategory_select.options[i] = new Option(sub_categories[index][i], i+1);
      }
      // イメージ画像を表示
      showImage();
  }

  /*
  * 画像表示 メソッド
  * 選択された以下のプルダウンから、イメージ画像を表示する。
  *   ・カテゴリー・サブカテゴリー・カラー
  */
  function showImage(){
    // イメージ画像が格納されているフォルダ
    const image_folder = "image/";
    // アンダーバー "_"
    const unbar = "_";
    // 画像形式 ".png"
    const png = ".png";
    document.getElementById("regist-image").src=("image/2_3_yellow.png");

    // 選択されたカテゴリー
    var category_index = document.getElementById("category").selectedIndex;
    // 選択されたサブテゴリー
    var subCategory_index = document.getElementById("sub_category").selectedIndex;
    // 選択されたカラー
    var color_index = document.getElementById("color").selectedIndex;
    var pics = new Array("1_1_pink.png","2_3_yellow.png","3_1_blue.png","4_5_blue.png","5_4_black.png");

    // 各選択から画像名を作成(暫定：カテゴリのみで画像を表示)
    // var image_name = image_folder + category_index + unbar + subCategory_index + unbar + color_value + png;
    var image_name = image_folder + pics[category_index];
    // 画像を表示
    document.getElementById("regist-image").src=(image_name);
  }



  // カメラ起動関数
  function boot_camera(){
    console.log("click");

    //成功時に呼び出されるコールバック関数
    var onSuccess = function(imageURI){
      var image = document.getElementById("regist-image");
      image.src = imageURI;
      alert(imageURI);
    };

    //失敗時に呼び出されるコールバック関数
    var onError = function(message){
      alert("Error:" + message);
    };

    var screenWidth = screen.width;
    var screenHeight = screen.height;
    var image = document.getElementById("regist-image");
      
    image.height = screenHeight / 3;
    image.width = screenWidth / 4 * 3;
    var option = {};
    navigator.camera.getPicture(onSuccess, onError, option);
  }

  // ニフクラmobile backendのキー設定
  // API key.
  var applicationKey    = "a5b0d94a415cb1c985e0766684fb926608305759441c8777962112ea428df5ae";
  var clientKey = "c0d33b2d67b4aeb9e608b6c2774965128e10e2c267e06c19654032e4a8f1de2e";
  // SDK initialization.
  var ncmb = new NCMB(applicationKey, clientKey);
  // 「登録」ボタン押下時の処理
  function itemRegist_mobileBackend(){

    var category = document.getElementById("category").value;
    var sub_category = document.getElementById("sub_category").value;
    var color = document.getElementById("color").value;
    var design = document.getElementById("design").value;
    var material = document.getElementById("material").value;
    
    var season_radio =  document.getElementsByName("season");
    var season = "";
    for(var i = 0; i < season_radio.length ; i++){
      if (season_radio[i].checked){
        //選択されたラジオボタンのvalue値を取得する
        season = season_radio[i].value;
        break;
      }
    }

    var size = document.getElementById("size").value;
    var brand = document.getElementById("brand").value;
    var remarks = document.getElementById("remarks").value;
    var image = document.getElementById("image").src;
    // ログインユーザを取得
    var currentUser = ncmb.User.getCurrentUser();

    var Item = ncmb.DataStore("item");
    var insertItem = new Item();
    insertItem.set("category", category) 
              .set("sub_category", sub_category)
              .set("color", color)
              .set("design", design)
              .set("material", material)
              .set("season", season)
              .set("size", size)
              .set("brand", brand)
              .set("remarks", remarks)
              .set("image", image)
              .set("userId", currentUser.get("objectId"))
              .save()
              .then(function(insertItem){
                // 保存後の処理
                console.log("Inserted!");
                console.log('category: ' + category);
                console.log('sub_category: ' + sub_category);
                console.log('color: ' + color);
                console.log('design: ' + design);
                console.log('material: ' + material);
                console.log('season: ' + season);
                console.log('size: ' + size);
                console.log('brand: ' + brand);
                console.log('remarks: ' + remarks);
                console.log('image: ' + image);
                document.getElementById('nav').popPage();
              })
              .catch(function(err){
                // エラー処理
                console.log("Err#" + err.code +": " +err.message);   
              });              
  }

  </script>

</ons-page>