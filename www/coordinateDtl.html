<ons-page id="coordinateDtl">

	<head>
		<ons-toolbar>
			<div class="left">
				<ons-back-button>Back</ons-back-button>
			</div>
			<div class="center">
				<ons-icon icon="user-circle"></ons-icon>コーディネート詳細画面</div>
		</ons-toolbar>
	</head>

	<body>

		<div>
			<p class="box" style="border-bottom: 2px solid blue; color: black; border-color:black; text-align:center;">
				<font face="fantasy" size="5"> COORDINATE </font>
			</p>
			<table border="0" style="margin-left: auto; margin-right: auto;">
				<tr>
					<td colspan="1" rowspan="2">
						<!-- トップス -->
						<input id="tops_image" type="image" width="100" height="100">
					</td>
					<td colspan="1" rowspan="3">
						<!-- アウター -->
						<input id="outer_image" type="image" width="100" height="100">
					</td>
          <td colspan="1" rowspan="6" width="5" valign="top">
						<div style="text-align: center">
							<div style="text-align: center ;display:none">
								<ons-checkbox input-id="coofvrtFlg" value="1"></ons-checkbox>
							</div>
							<div style="color:#D2D2D2; font-size: 30px;">
								<label for="coofvrtFlg" class="center">★</label>
							</div>
						</div>
					</td>
				</tr>
				<tr></tr>
				<tr>
					<td colspan="1" rowspan="2">
						<!-- ボトムス -->
						<input id="bottoms_image" type="image" width="100" height="100">
					</td>
				</tr>
				<tr>
					<td colspan="1" rowspan="3"></td>
				</tr>
				<tr>
					<td colspan="1" rowspan="2">
						<!-- 靴 -->
						<input id="shoes_image" type="image" width="100" height="100">
					</td>
				</tr>
			</table>

		</div>
		<div>
			<p class="box" style="border-top: 2px solid blue; color: black; border-color:black; text-align:center;">
				<font face="fantasy" size="5"> ITEM LIST </font>
			</p>

			<table border="0" style="margin-left: auto; margin-right: auto; border-collapse: separate; border-spacing: 16px 8px; color:black; table-layout: fixed">
				<!-- アウター -->
				<tr>
					<!-- 画像 -->
					<td><input id="outer_image2" type="image" width="100" height="100"></td>
					<td width="5" valign="top">
						<div style="text-align:center">
							<input type="checkbox" id="fvrtOuter" style="display:none;" value="1" onChange="chageFvrt(this)">
							<div id="fvrtOuterBg" style="color:#D2D2D2; font-size: 30px;">
								<label for="fvrtOuter" class="top"><font id="outerStar" color="#c0c0c0">★</font></label>
							</div>
						</div>
					</td>

					<!-- 詳細 -->
					<td>
						<table border="0" style="font-size: 5pt;">
							<tr>
								<td align="left">カテゴリー</td>
								<td>:</td>
								<td>アウター</td>
							</tr>
							<tr>
								<td align="left">サブカテゴリー</td>
								<td>:</td>
								<td id="outer_sub"></td>
							</tr>
							<tr>
								<td align="left">カラー</td>
								<td>:</td>
								<td id="outer_color"></td>
							</tr>
							<tr>
								<td align="left">パターン</td>
								<td>:</td>
								<td id="outer_design"></td>
							</tr>
							<tr>
								<td align="left">サイズ</td>
								<td>:</td>
								<td id="outer_size"></td>
							</tr>
						</table>
					</td>
				</tr>

				<!-- トップス -->
				<tr>
					<!-- 画像 -->
					<td><input id="tops_image2" type="image" width="100" height="100"></td>
					<td width="5" valign="top">
						<div style="text-align: center">
							<div style="text-align: center ;display:none">
								<ons-checkbox input-id="fvrtFlg" value="1"></ons-checkbox>
							</div>
							<div style="color:#D2D2D2; font-size: 30px;">
								<label for="fvrtFlg" class="center">★</label>
							</div>
						</div>
					</td>
					<!-- 詳細 -->
					<td>
						<table border="0" style="font-size: 5pt">
							<tr>
								<td align="left">カテゴリー</td>
								<td>:</td>
								<td>トップス</td>
							</tr>
							<tr>
								<td align="left">サブカテゴリー</td>
								<td>:</td>
								<td id="tops_sub"></td>
							</tr>
							<tr>
								<td align="left">カラー</td>
								<td>:</td>
								<td id="tops_color"></td>
							</tr>
							<tr>
								<td align="left">パターン</td>
								<td>:</td>
								<td id="tops_design"></td>
							</tr>
							<tr>
								<td align="left">サイズ</td>
								<td>:</td>
								<td id="tops_size"></td>
							</tr>
						</table>
					</td>
				</tr>

				<!-- ボトムス-->
				<tr>
					<!-- 画像 -->
					<td><input id="bottoms_image2" type="image" width="100" height="100"></td>
					<td width="5" valign="top">
						<div style="text-align: center">
							<div style="text-align: center ;display:none">
								<ons-checkbox input-id="fvrtFlg" value="1"></ons-checkbox>
							</div>
							<div style="color:#D2D2D2; font-size: 30px;">
								<label for="fvrtFlg" class="center">★</label>
							</div>
						</div>
					</td>
					<!-- 詳細 -->
					<td>
						<table border="0" style="font-size: 5pt">
							<tr>
								<td align="left">カテゴリー</td>
								<td>:</td>
								<td>ボトムス</td>
							</tr>
							<tr>
								<td align="left">サブカテゴリー</td>
								<td>:</td>
								<td id="bottoms_sub"></td>
							</tr>
							<tr>
								<td align="left">カラー</td>
								<td>:</td>
								<td id="bottoms_color"></td>
							</tr>
							<tr>
								<td align="left">パターン</td>
								<td>:</td>
								<td id="bottoms_design"></td>
							</tr>
							<tr>
								<td align="left">サイズ</td>
								<td>:</td>
								<td id="bottoms_size"></td>
							</tr>
						</table>
					</td>
				</tr>

				<!-- 靴 -->
				<tr>
					<!-- 画像 -->
					<td><input id="shoes_image2" type="image" width="100" height="100"></td>
					<td width="5" valign="top">
						<div style="text-align: center">
							<div style="text-align: center ;display:none">
								<ons-checkbox input-id="fvrtFlg" value="1"></ons-checkbox>
							</div>
							<div style="color:#D2D2D2; font-size: 30px;">
								<label for="fvrtFlg" class="center">★</label>
							</div>
						</div>
					</td>
					<!-- 詳細 -->
					<td>
						<table border="0" style="font-size: 5pt">
							<tr>
								<td align="left">カテゴリー</td>
								<td>:</td>
								<td>シューズ</td>
							</tr>
							<tr>
								<td align="left">サブカテゴリー</td>
								<td>:</td>
								<td id="shoes_sub"></td>
							</tr>
							<tr>
								<td align="left">カラー</td>
								<td>:</td>
								<td id="shoes_color"></td>
							</tr>
							<tr>
								<td align="left">パターン</td>
								<td>:
									<td id="shoes_design"></td>
							</tr>
							<tr>
								<td align="left">サイズ</td>
								<td>:</td>
								<td id="shoes_size"></td>
							</tr>
						</table>
						</td>
				</tr>
			</table>

		</div>

	</body>

	<script>
	// コーディネート画面から送信されたobjectId
  var objectId;

  // アイテム一覧のお気に入りフラグ変更
  function chageFvrt(e){
    
    // データベースに接続
    var items = ncmb.DataStore("item");

    // 選択されたＩＤ取得
    var id = e.id;

    // itemインデックス
    var itemIdx = 0;

    var flag = 0;

    if('fvrtOuter' === id){
      flag =  document.getElementById("fvrtOuter").value;
      itemIdx = 0;
      if(flag == 1){
        document.getElementById("outerStar").color = '#ffff00';
        document.getElementById("fvrtOuter").value = 0;
        console.log('お気に入りフラグ true：' + flag);
      } else {
        document.getElementById("outerStar").color = '#c0c0c0';
        document.getElementById("fvrtOuter").value = 1;
        console.log('お気に入りフラグ false：' + flag);
      }
    } else if('fvrtTops' === id) {
      flag =  document.getElementById("fvrtTops").value;
      itemIdx = 1;
      if(flag == 1){
        document.getElementById("fvrtTopsBg").style.backgroundColor = '#ffffff';
        document.getElementById("fvrtTops").value = 0;
        console.log('お気に入りフラグ true：' + flag);
      } else {
        document.getElementById("fvrtTopsBg").style.backgroundColor = '#ff0000';
        document.getElementById("fvrtTops").value = 1;
        console.log('お気に入りフラグ false：' + flag);
      }
    } else if('fvrtBottoms' === id) {
      flag =  document.getElementById("fvrtBottoms").value;
      itemIdx = 2;
      if(flag == 1){
        document.getElementById("fvrtBottomsBg").style.backgroundColor = '#ffffff';
        document.getElementById("fvrtBottoms").value = 0;
        console.log('お気に入りフラグ true：' + flag);
      } else {
        document.getElementById("fvrtBottomsBg").style.backgroundColor = '#ff0000';
        document.getElementById("fvrtBottoms").value = 1;
        console.log('お気に入りフラグ false：' + flag);
      }
    } else if('fvrtShoes' === id) {
      flag =  document.getElementById("fvrtShoes").value;
      itemIdx = 3;
      if(flag == 1){
        document.getElementById("fvrtShoesBg").style.backgroundColor = '#ffffff';
        document.getElementById("fvrtShoes").value = 0;
        console.log('お気に入りフラグ true：' + flag);
      } else {
        document.getElementById("fvrtShoesBg").style.backgroundColor = '#ff0000';
        document.getElementById("fvrtShoes").value = 1;
        console.log('お気に入りフラグ false：' + flag);
      }
    }

    // テーブルの更新
    items.equalTo("objectId", objectId[itemIdx])
        .fetchAll()
        .then(function(results){
          // object取得
          var item = results[0];
          item.set("fvrtFlg", flag);
          return item.update();
        })
        .catch(function(err){
          // エラー処理
          console.log("Err#" + err.code +": " +err.message);
        });
  }

  // 画面表示時
  ons.getScriptPage().onShow = function() {
    
    console.log("コーディネート詳細画面:onShow");

    // データベースに接続
    var items = ncmb.DataStore("item");

    // コーディネート画面から送信されたデータを取得
    objectId = this.data.objectIdArr;

    // 出力するアイテムの順番
    var CATEGORY = ["tops", "bottoms", "outer", "shoes"];

    // カウント変数
    var idx = 0;

    objectId.forEach(
      function(id){
        items.equalTo("objectId", id)
          .fetchAll()
          .then(
            function(results){
              var obj = results[0];
              // コーディネート画像を設定
              document.getElementById(CATEGORY[idx] + "_image").src = (obj.get("image"));
              // ITEM LIST画像を設定
              document.getElementById(CATEGORY[idx] + "_image2").src = (obj.get("image"));
              // 各アイテムの詳細を設定←サブカテゴリのカラム名に自信なし
              document.getElementById(CATEGORY[idx] + "_sub").innerHTML = convert_sub_category(obj.get("category"),obj.get("subcategory"));
              document.getElementById(CATEGORY[idx] + "_color").innerHTML = convert_color(obj.get("color"));document.getElementById(CATEGORY[idx] + "_design").innerHTML = convert_design(obj.get("design"));document.getElementById(CATEGORY[idx] + "_size").innerHTML = convert_size(obj.get("size"));
            }
          )
          .catch(
            function(err){
              console.log(err);
            }
          );

        idx = idx + 1;
      }
    );
  }
	</script>

</ons-page>