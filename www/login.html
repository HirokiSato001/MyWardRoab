<ons-page id="login">

	<script language="javascript" type="text/javascript">
		function OnLinkClick() {
          document.getElementById('nav').pushPage('userRegist.html', {});
            target = document.getElementById("output");
            return false;
        }
	</script>

	<ons-toolbar>
		<div class="center">ログイン</div>
	</ons-toolbar>


	<div style="text-align: center; margin-top: 30px;">
		<p>
			ユーザーID（メールアドレス）
			<br>
			<ons-input id="login_mailAddress" modifier="underbar" placeholder="MailAddress" float></ons-input>
		</p>
		<p>
			パスワード
			<br>
			<ons-input id="login_password" type="password" modifier="underbar" placeholder="Password" float></ons-input>
		</p>
		<p style="margin-top: 30px;">
			<ons-button onclick="login()">ログイン</ons-button>
			<ons-button onclick="test_login()">ログイン(固定ユーザ)</ons-button>
		</p>
    <br>
		<p>
			<u>
				<a href="javascript:OnLinkClick();">新規登録はこちら</a><br />
				<br>
				<div id="output"></div>
			</u>
		</p>
		<p>
			<u>
				<a href="～～～.html">パスワードを忘れた方はこちら</a>
			</u>
		</p>

	</div>

	<script>
		// 画面表示時に起動
	ons.ready(function() {

	});
	ons.getScriptPage().onShow = function() {
		autoLogin();
	}


	var mailAddress;
	var password;
	// javaScript関数
	function login() {
		//id="username"の値を取得
		mailAddress = document.getElementById('login_mailAddress').value;
		//id="password"の値を取得
		password = document.getElementById('login_password').value;

		doLogin(mailAddress, password);
	}


	function test_login() {

		doLogin("aa@a.a", "aaaa");
	}

	function autoLogin() {

		console.log("autoLogin");
		var currentUser = ncmb.User.getCurrentUser();

		if (currentUser) {
			console.log("ログイン中のユーザーあり: " + currentUser.get("userName"));
			doLogin(currentUser.get("mailAddress"), currentUser.get("password"));
		} else {
			console.log("未ログインまたは取得に失敗");
		}
	}

	function doLogin(mailAddress, password) {

		console.log("Try login ... " + mailAddress + ":" + password);
		ncmb.User.login(mailAddress, password)
			.then(function(e) {
				// ログイン後処理
				document.getElementById('nav').pushPage('top.html', {});
			})
			.catch(function(e) {
				// エラー処理
				ons.notification.alert('メールアドレスまたはパスワードが間違っています');
			});
	}



	</script>
</ons-page> 