<ons-page id="coordinate">

	<head>
		<ons-toolbar>
			<div class="left">
				<ons-back-button>Back</ons-back-button>
			</div>
			<div class="center">
				<ons-icon icon="user-circle"></ons-icon>コーディネート</div>
		</ons-toolbar>
	</head>

	<body>


		<div id="coordinate" ＞ <br>


			<div>
				<p class="box" style="border-bottom: 2px solid blue; color: navy; border-color:navy; text-align:center;">

					<font size="5"> コーデＡ </font>
				</p>

				<a onClick="send_coordinateDtl_A()">
					<table border="0" style="margin-left: auto; margin-right: auto;">
						<tr>
							<td colspan="1" rowspan="2">
								<!-- トップス -->
								<!-- <input id="tops_image_1" type="image" src="/image/1_1.png"  width="100" height="100"> -->
								<img src="image/1_1_pink.png" id='coordhinate_tops_image_1' alt="トップスの画像" style="float:left;" width="100px" height="100px">
							</td>
							<td colspan="1" rowspan="3">
								<!-- アウター -->
								<!-- <input id="outer_image_1" type="image" src="/image/3_1.png"  width="100" height="100"> -->
								<img src="image/3_1_blue.png" id='coordhinate_outer_image_1' alt="アウターの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr></tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- ボトムス -->
								<!-- <input id="bottoms_image_1" type="image" src="/image/2_1.png"  width="100" height="100"> -->
								<img src="image/2_6_blue.png" id='coordhinate_bottoms_image_1' alt="ボトムスの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="3"></td>
						</tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- 靴 -->
								<!-- <input id="shoes_image_1" type="image" src="/image/5_7.png"  width="100" height="100"> -->
								<img src="image/5_5_red.png" id='coordhinate_shoes_image_1' alt="シューズの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
					</table>
				</a>
			</div>

			<div>
				<p class="box" style="border-bottom: 2px solid blue; color: navy; border-color:navy; text-align:center;">
					<font size="5"> コーデB </font>
				</p>
				<a onClick="send_coordinateDtl_B()">

					<table border="0" style="margin-left: auto; margin-right: auto;">
						<tr>
							<td colspan="1" rowspan="2">
								<!-- トップス -->
								<img src="image/1_1_pink.png" id='coordhinate_tops_image_2' alt="トップスの画像" style="float:left;" width="100px" height="100px">
							</td>
							<td colspan="1" rowspan="3">
								<!-- アウター -->
								<img src="image/3_1_blue.png" id='coordhinate_outer_image_2' alt="アウターの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr></tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- ボトムス -->
								<img src="image/2_6_blue.png" id='coordhinate_bottoms_image_2' alt="ボトムスの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="3"></td>
						</tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- 靴 -->
								<img src="image/5_5_red.png" id='coordhinate_shoes_image_2' alt="シューズの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
					</table>
				</a>

			</div>

			<div>
				<p class="box" style="border-bottom: 2px solid blue; color: navy; border-color:navy; text-align:center;">
					<font size="5"> コーデC </font>
				</p>
				<a onClick="send_coordinateDtl_C()">
					<table border="0" style="margin-left: auto; margin-right: auto;">
						<tr>
							<td colspan="1" rowspan="2">
								<!-- トップス -->
								<img src="image/1_1_pink.png" id='coordhinate_tops_image_3' alt="トップスの画像" style="float:left;" width="100px" height="100px">
							</td>
							<td colspan="1" rowspan="3">
								<!-- アウター -->
								<img src="image/3_1_blue.png" id='coordhinate_outer_image_3' alt="アウターの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr></tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- ボトムス -->
								<img src="image/2_6_blue.png" id='coordhinate_bottoms_image_3' alt="ボトムスの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="3"></td>
						</tr>
						<tr>
							<td colspan="1" rowspan="2">
								<!-- 靴 -->
								<img src="image/5_5_red.png" id='coordhinate_shoes_image_3' alt="シューズの画像" style="float:left;" width="100px" height="100px">
							</td>
						</tr>
					</table>
				</a>

			</div>

		</div>

		<br>



	</body>

	<script>
	  // カテゴリーの項目
	  var items = ncmb.DataStore("item");
	  var objectId_tops_A = ""
	  var objectId_bottoms_A = ""
	  var objectId_outer_A = ""
	  var objectId_shoes_A = ""
	  var objectId_tops_B = ""
	  var objectId_bottoms_B = ""
	  var objectId_outer_B = ""
	  var objectId_shoes_B = ""
	  var objectId_tops_C = ""
	  var objectId_bottoms_C = ""
	  var objectId_outer_C = ""
	  var objectId_shoes_C = ""
	  // 画面表示時
	  ons.getScriptPage().onShow = function() {
	    // 3コーディネート提案
	    suggestionThreeCordhinate();
	  }
	  // コーディネート詳細画面Aへの遷移
	  function send_coordinateDtl_A() {
	    console.log("objectId_tops_A," + objectId_tops_A)
	    console.log("objectId_bottoms_A," + objectId_bottoms_A)
	    console.log("objectId_outer_A," + objectId_outer_A)
	    console.log("objectId_shoes_A," + objectId_shoes_A)
	    send_coordinateDtl(objectId_tops_A, objectId_bottoms_A, objectId_outer_A, objectId_shoes_A)
	  };

	  // コーディネート詳細画面Bへの遷移
	  function send_coordinateDtl_B() {
	    console.log("objectId_tops_B," + objectId_tops_B)
	    console.log("objectId_bottoms_B," + objectId_bottoms_B)
	    console.log("objectId_outer_B," + objectId_outer_B)
	    console.log("objectId_shoes_B," + objectId_shoes_B)
	    send_coordinateDtl(objectId_tops_B, objectId_bottoms_B, objectId_outer_B, objectId_shoes_B)
	  };
	  // コーディネート詳細画面Cへの遷移
	  function send_coordinateDtl_C() {
	    console.log("objectId_tops_C," + objectId_tops_C)
	    console.log("objectId_Cottoms_C," + objectId_Cottoms_C)
	    console.log("objectId_outer_C," + objectId_outer_C)
	    console.log("objectId_shoes_C," + objectId_shoes_C)
	    send_coordinateDtl(objectId_tops_C, objectId_Cottoms_C, objectId_outer_C, objectId_shoes_C)
	  };

	  function send_coordinateDtl(objectId_tops, objectId_bottoms, objectId_outer, objectId_shoes) {
	    document.getElementById('nav').pushPage('coordinateDtl.html', {
	      data: {
	        objectId_tops,
	        objectId_bottoms,
	        objectId_outer,
	        objectId_shoes
	      }
	    });
	  }

	  // 現在月から季節を取得
	  function getSeason() {
	    var now = new Date();
	    // 現在月(値的には-1したものが返却される。1月の場合は0,12月の場合は11)
	    var wkMonth = now.getMonth();
	    switch (wkMonth) {
	      // 春(3~5月)
	      case 2:
	      case 3:
	      case 4:
	        return 1
	        // 夏(6~8月)
	      case 5:
	      case 6:
	      case 7:
	        return 2
	        // 秋(9~11月)
	      case 8:
	      case 9:
	      case 10:
	        return 3
	        // 冬(12~2月)
	      case 11:
	      case 0:
	      case 1:
	        return 4
	        break
	      default:
	        console.log('エラー')
	    }
	    return 9
	  }
	  var result_tops = new Array()
	  var result_bottoms = new Array()
	  var result_outer = new Array()
	  var result_shoes = new Array()
	  var royalRoadCordhinateArray = new Array() // {点数,アウター,トップス,ボトムス}Stringでまとめる
	  var favoriteCordhinateArray = new Array() // {アウター,トップス,ボトムス}Stringでまとめる
	  var randomCordhinateArray = new Array() // {アウター,トップス,ボトムス}Stringでまとめる

	  // コーディネートを3つ提案する(KAI-005,009)
	  function suggestionThreeCordhinate() {
	    // 今の季節に一致したアイテムをカテゴリ順で全取得
	    var currentSeason = getSeason()
	    // カテゴリの全組み合わせを算出
	    items.equalTo("season", String(currentSeason)).order("category", false)
	      .fetchAll()
	      .then(function(results) {
	        // カテゴリごとに配列にわける
	        for (var i = 0; i < results.length; i++) {
	          object = results[i];
	          switch (String(object.get("category"))) {
	            // トップス
	            case "1":
	              result_tops.push(object)
	              break
	              // ボトムス
	            case "2":
	              result_bottoms.push(object)
	              break
	              // アウター
	            case "3":
	              result_outer.push(object)
	              break
	              // シューズ
	            case "4":
	              result_shoes.push(object)
	              break
	            default:
	              console.log('カテゴリの全組み合わせを算出 エラー')
	          }
	        }
	        console.log("tops count:" + result_tops.length)
	        console.log("bottom count:" + result_bottoms.length)
	        console.log("outer count:" + result_outer.length)
	        console.log("shoes count" + result_shoes.length)
	        // すべての組み合わせ
	        for (var i_top = 0; i_top < result_tops.length; i_top++) {
	          for (var i_outer = 0; i_outer < result_outer.length; i_outer++) {
	            for (var i_bottom = 0; i_bottom < result_bottoms.length; i_bottom++) {
	              /** 王道コーディネート */
	              var wkStr = ""
	              // 色採点
	              wkStr = allocationColor(result_outer[i_outer].get("color"), result_tops[i_top].get("color"), result_bottoms[i_bottom].get("color"))
	              wkStr = wkStr + "," + i_outer + "," + i_top + "," + i_bottom
	              royalRoadCordhinateArray.push(wkStr)

	              /** お気に入りコーディネート */
	              if (favoriteCordhinate(result_outer[i_outer], result_tops[i_top], result_bottoms[i_bottom])) {
	                wkStr = i_outer + "," + i_top + "," + i_bottom
	                console.log("お気に入りコーデ追加:" + wkStr)
	                favoriteCordhinateArray.push(wkStr)

	              }

	              /** ランダムコーディネート */
	              wkStr = i_outer + "," + i_top + "," + i_bottom
	              randomCordhinateArray.push(wkStr)
	            }
	          }
	        }

	        console.log("季節考慮_王道Arrayの数:" + royalRoadCordhinateArray.length)
	        console.log("季節考慮_お気に入りArrayの数:" + favoriteCordhinateArray.length)
	        console.log("季節考慮_ランダムArrayの数:" + randomCordhinateArray.length)

	        /** 王道コーディネートの選択---------- */
	        var royalRodeSetFlg = false
	        var favoriteSetFlg = false
	        var randomSetFlg = false
	        // 採点した組み合わせを降順にソート
	        if (royalRoadCordhinateArray.length != 0) {
	          royalRoadCordhinateArray.sort()
	          royalRoadCordhinateArray.reverse()
	          // 同点数の要素内でシャッフル
	          royalRoadCordhinateArray = royalRoadCordhinateArrayShuffle(royalRoadCordhinateArray)

	          // シャッフルした結果の配列の先頭を提案する
            sleep(100)
	          var royalRoakdResult = royalRoadCordhinateArray[0].split(",")
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)
	          // １つ目のコーディネートに表示
	          setObjectItems_A(royalRoakdResult, randomShoesIndex)
	          royalRodeSetFlg = true
            console.log("季節考慮　王道　表示完了")
	        }
	        /** お気に入りコーディネートの選択---------- */
	        if (favoriteCordhinateArray.length != 0) {
	          // 配列をシャッフル
            // シャッフルするとundifinedになることが多々あり不安定なのでやめる
	          // favoriteCordhinateArray = arrayShuffle(favoriteCordhinateArray, 0, favoriteCordhinateArray.length)
	          // シャッフルした結果の配列の先頭を提案する

	          var favoriteResult = favoriteCordhinateArray[Math.floor(Math.random() * favoriteCordhinateArray.length)].split(",")
	          favoriteResult.unshift('dummy')
            
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)
	          // ２つ目のコーディネートに表示
	          setObjectItems_B(favoriteResult, randomShoesIndex)
	          favoriteSetFlg = true
            console.log("季節考慮　好みコーデ　表示完了")
            
	        }
	        /** ランダムコーディネートの選択---------- */
	        if (randomCordhinateArray.length != 0) {

	          // randomCordhinateArray = arrayShuffle(randomCordhinateArray, 0, randomCordhinateArray.length)
	          // シャッフルした結果の配列の先頭を提案する
	          var randomResult = randomCordhinateArray[Math.floor(Math.random() * randomCordhinateArray.length)].split(",")
	          randomResult.unshift('dummy')
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)

	          // ３つ目のコーディネートに表示
	          setObjectItems_C(randomResult, randomShoesIndex)
	          randomSetFlg = true
            console.log("季節考慮　チャレンジコーデ　表示完了")            
	        }
      // ちょっとタイム。同じ名前の配列を使っているせいか、変な動きするため
      // sleep(500);

	        // TODO 季節で選んだら、コーディネートがなかったパターン
	        // suggestionCoordinateNonAboutSeason(royalRodeSetFlg, favoriteSetFlg, randomSetFlg)


	      })
	      .catch(function(err) {
	        console.log(err);
	      });
	  }

	  // 画像と、3コーデのうちどこに表示するか(pos)を引数に、画面に表示する
	  function showImageOnHTML(top_img, bottoms_img, outer_img, shoes_img, pos) {
	    console.log("イメージ表示：" + pos)
	    console.log("イメージ表示top：" + top_img)
	    console.log("イメージ表示bottom：" + bottoms_img)
	    console.log("イメージ表示outer：" + outer_img)
	    console.log("イメージ表示shoes：" + shoes_img)
      
	    document.getElementById("coordhinate_tops_image_" + pos.toString()).src = (top_img);
	    document.getElementById("coordhinate_bottoms_image_" + pos.toString()).src = (bottoms_img);
	    document.getElementById("coordhinate_outer_image_" + pos.toString()).src = (outer_img);
	    document.getElementById("coordhinate_shoes_image_" + pos.toString()).src = (shoes_img);
	  }

	  function setObjectItems_A(argResultArray, randomShoesIndex) {
	    console.log("setobjectitemsA:" + argResultArray[2] + "," + argResultArray[3] + "," + argResultArray[1])

	    objectId_tops_A = result_tops[argResultArray[2]].get("objectId")
	    objectId_bottoms_A = result_bottoms[argResultArray[3]].get("objectId")
	    objectId_outer_A = result_outer[argResultArray[1]].get("objectId")
	    objectId_shoes_A = result_shoes[randomShoesIndex].get("objectId")
	    showImageOnHTML(result_tops[argResultArray[2]].get("image"), result_bottoms[argResultArray[3]].get("image"), result_outer[argResultArray[1]].get("image"), result_shoes[randomShoesIndex].get("image"), 1)

	  }

	  function setObjectItems_B(argResultArray, randomShoesIndex) {
	    console.log("setobjectitemsB:" + argResultArray[2] + "," + argResultArray[3] + "," + argResultArray[1])

	    objectId_tops_B = result_tops[argResultArray[2]].get("objectId")
	    objectId_bottoms_B = result_bottoms[argResultArray[3]].get("objectId")
	    objectId_outer_B = result_outer[argResultArray[1]].get("objectId")
	    objectId_shoes_B = result_shoes[randomShoesIndex].get("objectId")

	    showImageOnHTML(result_tops[argResultArray[2]].get("image"), result_bottoms[argResultArray[3]].get("image"), result_outer[argResultArray[1]].get("image"), result_shoes[randomShoesIndex].get("image"), 2)
	  }

	  function setObjectItems_C(argResultArray, randomShoesIndex) {
	    console.log("setobjectitemsC:" + argResultArray[2] + "," + argResultArray[3] + "," + argResultArray[1])

	    objectId_tops_C = result_tops[argResultArray[2]].get("objectId")
	    objectId_bottoms_C = result_bottoms[argResultArray[3]].get("objectId")
	    objectId_outer_C = result_outer[argResultArray[1]].get("objectId")
	    objectId_shoes_C = result_shoes[randomShoesIndex].get("objectId")

	    showImageOnHTML(result_tops[argResultArray[2]].get("image"), result_bottoms[argResultArray[3]].get("image"), result_outer[argResultArray[1]].get("image"), result_shoes[randomShoesIndex].get("image"), 3)
	  }

	  // お気に入りを考慮したコーディネート
	  // 引数の中に、お気に入り色orお気に入りアイテムがあればtrueを返却する
	  function favoriteCordhinate(argOuter, argTops, argBottoms) {
	    // アイテムにお気に入りフラグが立っている場合
	    if (argOuter.get("fvrtFlg") == 1 || argTops.get("fvrtFlg") == 1 || argBottoms.get("fvrtFlg") == 1) {
	      return true
	    }
	    var wkUserColor = ncmb.User.getCurrentUser().get("favoriteColor");
	    // ユーザの好み色とアイテムの色が一致していた場合
	    if (argOuter.get("color") == wkUserColor || argTops.get("color") == wkUserColor || argBottoms.get("color") == wkUserColor) {
	      return true
	    }

	    // コーディネートテーブルに登録されていた場合
	    var fvrtCrdnt = ncmb.DataStore("fvrtCrdnt");
	    fvrtCrdnt.equalTo("item1_objId", argTops.get("objectId"))
	      .equalTo("item2_objId", argBottoms.get("objectId"))
	      .equalTo("item3_objId", argOuter.get("objectId"))
	      .fetchAll()
	      .then(function(results) {
	        // 検索に一致した場合
	        if (results.lenght != 0) {
	          return true
	        }
	      })
	      .catch(function(err) {
	        console.log(err);
	      });
	    // 上記に当てはまらない場合はfalseを返す
	    return false
	  }

	  // 季節を考慮しないコーディネート(KAI-005,009)
	  function suggestionCoordinateNonAboutSeason(royalRodeSetFlg, favoriteSetFlg, randomSetFlg) {
      if(royalRodeSetFlg && favoriteSetFlg && randomSetFlg){
        console.log("全部決まってたので季節を考慮しないコディネートはなし")
        return 
      }

	    result_tops = new Array()
	    result_bottoms = new Array()
	    result_outer = new Array()
	    result_shoes = new Array()
	    royalRoadCordhinateArray = new Array()
	    favoriteCordhinateArray = new Array()
	    randomCordhinateArray = new Array()
	    console.log("季節を考慮しないコーディネート:" + royalRodeSetFlg + favoriteSetFlg + randomSetFlg)

	    // カテゴリの全組み合わせを算出
	    items.order("category", false)
	      .fetchAll()
	      .then(function(results) {
	        // カテゴリごとに配列にわける
	        for (var i = 0; i < results.length; i++) {
	          object = results[i];
	          switch (String(object.get("category"))) {
	            // トップス
	            case "1":
	              result_tops.push(object)
	              break
	              // ボトムス
	            case "2":
	              result_bottoms.push(object)
	              break
	              // アウター
	            case "3":
	              result_outer.push(object)
	              break
	              // シューズ
	            case "5":
	              result_shoes.push(object)
	              break
	            default:
	              console.log('季節を考慮しないコーディネート エラー')
	          }
	        }
	        console.log("tops count:" + result_tops.length)
	        console.log("bottom count:" + result_bottoms.length)
	        console.log("outer count:" + result_outer.length)
	        console.log("shoes count" + result_shoes.length)
	        // すべての組み合わせ
	        for (var i_top = 0; i_top < result_tops.length; i_top++) {
	          for (var i_outer = 0; i_outer < result_outer.length; i_outer++) {
	            for (var i_bottom = 0; i_bottom < result_bottoms.length; i_bottom++) {
	              /** 王道コーディネート */
	              var wkStr = ""
	              // 色採点
	              wkStr = allocationColor(result_outer[i_outer].get("color"), result_tops[i_top].get("color"), result_bottoms[i_bottom].get("color"))
	              wkStr = wkStr + "," + i_outer + "," + i_top + "," + i_bottom
	              royalRoadCordhinateArray.push(wkStr)

	              /** お気に入りコーディネート */
	              if (favoriteCordhinate(result_outer[i_outer], result_tops[i_top], result_bottoms[i_bottom])) {
	                wkStr = i_outer + "," + i_top + "," + i_bottom
	                console.log("お気に入りコーデ追加:" + wkStr)
	                favoriteCordhinateArray.push(wkStr)
	              }

	              /** ランダムコーディネート */
	              wkStr = i_outer + "," + i_top + "," + i_bottom
	              randomCordhinateArray.push(wkStr)
	            }
	          }
	        }

	        console.log("季節考慮しない_王道Arrayの数:" + royalRoadCordhinateArray.length)
	        console.log("季節考慮しない_お気に入りArrayの数:" + favoriteCordhinateArray.length)
	        console.log("季節考慮しない_ランダムArrayの数:" + randomCordhinateArray.length)

	        /** 王道コーディネートの選択---------- */
	        // 採点した組み合わせを降順にソート
	        if (royalRoadCordhinateArray.length != 0 && royalRodeSetFlg == false) {
	          royalRoadCordhinateArray.sort()
	          royalRoadCordhinateArray.reverse()
	          // 同点数の要素内でシャッフル
	          royalRoadCordhinateArray = royalRoadCordhinateArrayShuffle(royalRoadCordhinateArray)

	          // シャッフルした結果の配列の先頭を提案する
	          var royalRoakdResult = royalRoadCordhinateArray[0].split(",")
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)
	          // １つ目のコーディネートに表示
	          setObjectItems_A(royalRoakdResult, randomShoesIndex)
	          royalRodeSetFlg = true
	        }
	        /** お気に入りコーディネートの選択---------- */
	        if (favoriteCordhinateArray.length != 0 && favoriteSetFlg == false) {
	          // 配列をシャッフル
	          arrayShuffle(favoriteCordhinateArray, 0, favoriteCordhinateArray.length)
	          // シャッフルした結果の配列の先頭を提案する
	          var favoriteResult = favoriteCordhinateArray[0].split(",")
	          favoriteResult.unshift('dummy')
	          console.log(favoriteResult)
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)
	          // ２つ目のコーディネートに表示
	          setObjectItems_B(favoriteResult, randomShoesIndex)
	          favoriteSetFlg = true
	        }
	        /** ランダムコーディネートの選択---------- */
	        if (randomCordhinateArray.length != 0 && randomSetFlg == false) {
	          arrayShuffle(randomCordhinateArray, 0, randomCordhinateArray.length)
	          // シャッフルした結果の配列の先頭を提案する
	          var randomResult = randomCordhinateArray[0].split(",")
	          randomResult.unshift('dummy')
	          var randomShoesIndex = Math.floor(Math.random() * result_shoes.length)
	          // ３つ目のコーディネートに表示
	          setObjectItems_C(randomResult, randomShoesIndex)
	          randomSetFlg = true
	        }
	      })
	      .catch(function(err) {
	        console.log(err);
	      });
	  }

	  // 色配点
	  function allocationColor(outer_i, top_i, bottom_i) {
	    // ①王道パターン判定
	    if (noDoubtPattern(outer_i, top_i, bottom_i)) {
	      return "30"
	    }
	    // ②基準色による判定(白,黒,グレー,ベージュ,ネイビー,カーキ)
	    const basicColor = ["1", "2", "3", "4", "5", "7"]
	    if (basicColor.indexOf(top_i) !== -1 && basicColor.indexOf(outer_i) !== -1 && basicColor.indexOf(bottom_i) !== -1) {
	      return "20"
	    }
	    // ③残りの色の組み合わせ
	    return "10"
	  }

	  // 同点数で配列シャッフル
	  function royalRoadCordhinateArrayShuffle(array) {
	    // 前のスコア保持 
	    var result = array[0].split(",")
	    var preScore = result[0]
	    var startPos = 0
	    var endPos = 0

	    for (var i = 1; i < array.length; i++) {
	      result = array[i].split(",")
	      // 前のスコアと一緒の場合
	      if (preScore == result[0]) {
	        endPos = i
	      } else {
	        // 同点数の要素でシャッフル
	        arrayShuffle(array, startPos, endPos)
	        // スコアを塗替
	        preScore = result[0]
	        startPos = i
	        endPos = i
	      }
	    }
	    // 同点数の要素でシャッフル
	    arrayShuffle(array, startPos, endPos)
	    return array
	  }

	  // 配列のシャッフル(指定範囲)
	  function arrayShuffle(array, startPos, endPos) {
	    for (var i = startPos; endPos >= i; i++) {
	      // 開始～終了範囲でランダムに並び替え
	      var r = Math.floor(Math.random() * (endPos + 1 - startPos)) + startPos;
	      // 要素の並び替えを実行
	      var tmp = array[i];
	      array[i] = array[r];
	      array[r] = tmp;
	    }
	    return array;
	  }

	  // 王道10パターン
	  function noDoubtPattern(outerColor, topsColor, bottomsColor) {
	    // アウター	トップス	ボトムス
	    // 白 白 黒
	    if (outerColor == 2 && topsColor == 2 && bottomsColor == 1) {
	      return true

	      // グレー グレー 黒
	    } else if (outerColor == 3 && topsColor == 3 && bottomsColor == 1) {
	      return true

	      // 黒 黒 白
	    } else if (outerColor == 1 && topsColor == 1 && bottomsColor == 2) {
	      return true

	      // グレー 白 黒
	    } else if (outerColor == 3 && topsColor == 2 && bottomsColor == 1) {
	      return true

	      // 黒 白 グレー
	    } else if (outerColor == 1 && topsColor == 2 && bottomsColor == 3) {
	      return true

	      // ネイビー 白 黒
	    } else if (outerColor == 5 && topsColor == 2 && bottomsColor == 1) {
	      return true

	      // ベージュ 白 黒
	    } else if (outerColor == 7 && topsColor == 2 && bottomsColor == 1) {
	      return true

	      // 白 白 カーキ
	    } else if (outerColor == 2 && topsColor == 2 && bottomsColor == 4) {
	      return true

	      // カーキ 白 黒
	    } else if (outerColor == 4 && topsColor == 2 && bottomsColor == 1) {
	      return true

	      // カーキ 白 グレー
	    } else if (outerColor == 4 && topsColor == 2 && bottomsColor == 3) {
	      return true
	    }
	    return false
	  }

// ビジーwaitを使う方法
function sleep(waitMsec) {
  var startMsec = new Date();
 
  // 指定ミリ秒間だけループさせる（CPUは常にビジー状態）
  while (new Date() - startMsec < waitMsec);
}
 
	</script>
</ons-page>